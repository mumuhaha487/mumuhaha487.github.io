<!doctype html>
<html lang="en-us">
  <head>
    <title>（win10)yolov5训练自己的数据集 // 木哈文轩</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.123.3">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="木木em哈哈" />
    <meta name="description" content="文章浏览阅读416次。打开上面的标注数据的工具（原来用于dnf挂机的脚本工具，用了发现他的自动截图功能不错，而且标记出来的数据labels可以直接用，不用xml转txt了）选择使用GPU还是CPU。最后再试试调小 --batch-size，降低 --epoch。文件夹用于放置你标记的数据集的数据xml或者是txt，再在VOCData文件夹里面创建一个。epochs：指的就是训练过程中整个数据集将被迭代（训练）了多少次，显卡不行你就调小点。因为是用刚刚的应用程序来标注的图片文件所以就不需要把xml转为yolo格式的文件了。_windows 使用cpu 运行yolo5自己的数据" />
    <link rel="stylesheet" href="/css/main.min.a545955c4c2a15328ae3f208fda979c3a40146d5a6d4f95e0ab1a00e48cd1ff2.css" />
    

    
    <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="（win10)yolov5训练自己的数据集"/>
<meta name="twitter:description" content="文章浏览阅读416次。打开上面的标注数据的工具（原来用于dnf挂机的脚本工具，用了发现他的自动截图功能不错，而且标记出来的数据labels可以直接用，不用xml转txt了）选择使用GPU还是CPU。最后再试试调小 --batch-size，降低 --epoch。文件夹用于放置你标记的数据集的数据xml或者是txt，再在VOCData文件夹里面创建一个。epochs：指的就是训练过程中整个数据集将被迭代（训练）了多少次，显卡不行你就调小点。因为是用刚刚的应用程序来标注的图片文件所以就不需要把xml转为yolo格式的文件了。_windows 使用cpu 运行yolo5自己的数据"/>

    <meta property="og:title" content="（win10)yolov5训练自己的数据集" />
<meta property="og:description" content="文章浏览阅读416次。打开上面的标注数据的工具（原来用于dnf挂机的脚本工具，用了发现他的自动截图功能不错，而且标记出来的数据labels可以直接用，不用xml转txt了）选择使用GPU还是CPU。最后再试试调小 --batch-size，降低 --epoch。文件夹用于放置你标记的数据集的数据xml或者是txt，再在VOCData文件夹里面创建一个。epochs：指的就是训练过程中整个数据集将被迭代（训练）了多少次，显卡不行你就调小点。因为是用刚刚的应用程序来标注的图片文件所以就不需要把xml转为yolo格式的文件了。_windows 使用cpu 运行yolo5自己的数据" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://0ha.top/posts/130999472/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-02T01:50:05+00:00" />
<meta property="article:modified_time" content="2023-06-02T01:50:05+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://0ha.top/"><img class="app-header-avatar" src="https://s3.bmp.ovh/imgs/2024/02/27/ebc3b3191cd37c75.jpg" alt="木木em哈哈" /></a>
      <span class="app-header-title">木哈文轩</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">主页</a>
              ·  
          
          <a class="app-header-menu-item" href="/tags/">标签</a>
              ·  
          
          <a class="app-header-menu-item" href="/about/">有关</a>
      </nav>
      <p>别让我逮住嗷</p>
      <div class="app-header-social">
        
          <a href="https://blog.csdn.net/mumuemhaha" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-circle">
  <title>CSDN</title>
  <circle cx="12" cy="12" r="10"></circle>
</svg>
          </a>
        
          <a href="https://github.com/mumuhaha487" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">（win10)yolov5训练自己的数据集</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jun 2, 2023
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p><strong>目录</strong></p>
<p><a href="#%e7%8e%af%e5%a2%83%ef%bc%9a">环境：</a></p>
<p><a href="#python%e5%8c%85%e7%9a%84%e9%85%8d%e7%bd%ae">python包的配置</a></p>
<p><a href="#%e6%96%87%e4%bb%b6%e5%a4%b9%e8%b7%af%e5%be%84">文件夹路径</a></p>
<p><a href="#%e6%a0%87%e6%b3%a8%e6%95%b0%e6%8d%ae">标注数据</a></p>
<p><a href="#%e8%8e%b7%e5%8f%96%e7%94%b5%e8%84%91%2f%e8%a7%86%e9%a2%91%e9%87%8c%e7%9a%84%e5%9b%be%e7%89%87">获取电脑/视频里的图片</a></p>
<p><a href="#%e5%bc%80%e5%a7%8b%e6%a0%87%e8%ae%b0%e6%95%b0%e6%8d%ae">开始标记数据</a></p>
<p><a href="#%e5%88%92%e5%88%86%e5%88%92%e5%88%86%e8%ae%ad%e7%bb%83%e9%9b%86%e3%80%81%e9%aa%8c%e8%af%81%e9%9b%86%e3%80%81%e6%b5%8b%e8%af%95%e9%9b%86">划分划分训练集、验证集、测试集</a></p>
<p><a href="#%c2%a0%e6%8a%8a%e7%9b%b8%e5%ba%94%e7%9a%84%e6%96%87%e4%bb%b6%e8%b7%af%e5%be%84%e5%ad%98%e5%85%a5txt%e6%96%87%e4%bb%b6%e4%b8%ad%ef%bc%8cxml%e8%bd%ac%e4%b8%batxt">把相应的文件路径存入txt文件中，xml转为txt</a></p>
<p><a href="#%e5%88%9b%e5%bb%ba%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">创建配置文件</a></p>
<p><a href="#%e8%81%9a%e7%b1%bb%e8%8e%b7%e5%be%97%e5%85%88%e9%aa%8c%e6%a1%86">聚类获得先验框</a></p>
<p><a href="#%c2%a0%e5%bc%80%e5%a7%8b%e8%ae%ad%e7%bb%83">开始训练</a></p>
<p><a href="#%c2%a0%e8%bf%90%e8%a1%8c%e6%96%87%e4%bb%b6%ef%bc%9a">运行文件：</a></p>
<p><a href="#%e7%94%a8gpu%e8%ae%ad%e7%bb%83">用gpu训练</a></p>
<p><a href="#%e6%9f%a5%e7%9c%8bcuda%e7%89%88%e6%9c%ac">查看cuda版本</a></p>
<p><a href="#%e2%80%8b%e7%bc%96%e8%be%91">​编辑</a></p>
<p><a href="#%e5%ae%89%e8%a3%85pytorch">安装pytorch</a></p>
<p><a href="#%e8%ae%ad%e7%bb%83">训练</a></p>
<p><a href="#%e9%97%ae%e9%a2%98">问题</a></p>
<p><a href="#%e5%a6%82%e6%9e%9c%e5%87%ba%e7%8e%b0%20%ef%bc%88%e9%a1%b5%e9%9d%a2%e5%a4%aa%e5%b0%8f%ef%bc%8c%e6%97%a0%e6%b3%95%e5%ae%8c%e6%88%90%e6%93%8d%e4%bd%9c%ef%bc%89%e7%9a%84%e7%9b%b8%e5%85%b3%e9%97%ae%e9%a2%98">如果出现 （页面太小，无法完成操作）的相关问题</a></p>
<p><a href="#%c2%a0%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0%ef%bc%9a">参考文章：</a></p>
<h2 id="环境">环境：</h2>
<ul>
<li>windows 10</li>
<li>yolov5的源文件（链接<a href="https://www.123pan.com/s/HrkuVv-F9IX.html" title="yolov5">yolov5</a>）</li>
<li>标注工具（链接<a href="https://www.123pan.com/s/HrkuVv-Y9IX.html" title="标注">标注</a>）</li>
</ul>
<h2 id="python包的配置">python包的配置</h2>
<p>打开pycharm的终端<img src="https://0ha.top/img/c59abeb4cbf648bfa2dbc3df90b68a73.png" alt=""></p>
<p>运行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>pip install <span style="color:#f92672">-</span>r requirements<span style="color:#f92672">.</span>txt <span style="color:#f92672">-</span>i https:<span style="color:#f92672">//</span>mirrors<span style="color:#f92672">.</span>aliyun<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>pypi<span style="color:#f92672">/</span>simple
</span></span></code></pre></div><h2 id="文件夹路径">文件夹路径</h2>
<p>在data文件中创建一个VOCData文件</p>
<p>进入VOCData文件夹里面创建一个Annotations文件夹用于放置你标记的数据集的数据xml或者是txt，再在VOCData文件夹里面创建一个images的文件夹里面用于放你的训练的图片</p>
<p>先创建好，有没有还没有关系。</p>
<h2 id="标注数据">标注数据</h2>
<p>接下来就是标注数据集了</p>
<p>打开上面的标注数据的工具（原来用于dnf挂机的脚本工具，用了发现他的自动截图功能不错，而且标记出来的数据labels可以直接用，不用xml转txt了）</p>
<p><img src="https://0ha.top/img/00c7ebf35afe4f96bb5d0d5b8f4381e4.png" alt=""></p>
<h3 id="获取电脑视频里的图片">获取电脑/视频里的图片</h3>
<p>打开自动截图</p>
<p>要设置区域可以按照上面的文字来设置截图区域</p>
<p>然后开启全屏，之后直接ctrl+q键开始截图就行了（默认时间是3秒自动截图一次）</p>
<p><img src="https://0ha.top/img/7491b22b67ff4642956b09770e30d005.png" alt=""></p>
<p>默认是png，我用的jpg，为了防止后面代码报错，最好也改成这个吧</p>
<p>截图文件在软件目录下的的&quot;截图&quot;文件夹</p>
<p><img src="https://0ha.top/img/500c77bfdf63434c9a1a74b22c414523.png" alt=""></p>
<h3 id="开始标记数据">开始标记数据</h3>
<p><img src="https://0ha.top/img/0725c77e2bf341c7a4b06e25626a0418.png" alt=""></p>
<p>点击&quot;打开图库&quot;</p>
<p><img src="https://0ha.top/img/7feef0d81b8c4c8e8b02f30e944bc877.png" alt=""></p>
<p>把刚刚 截图的图片给复制进去</p>
<p>然后重启一次软件就可以开始标记了</p>
<p><img src="https://0ha.top/img/82a04931ed184dc58c31ba6d7ad6cb80.png" alt=""></p>
<p>需要注意的是最后要把没有任何标记的图片删除，以防后面执行代码时报错</p>
<h2 id="划分划分训练集验证集测试集">划分划分训练集、验证集、测试集</h2>
<p>在data/VOCData文件目录下面创建一个py文件（名字随意，认得出来就行）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># coding:utf-8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#xml文件的地址，根据自己的数据进行修改 xml一般存放在Annotations下</span>
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--xml_path&#39;</span>, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Annotations&#39;</span>, type<span style="color:#f92672">=</span>str, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;input xml label path&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#数据集的划分，地址选择自己数据下的ImageSets/Main</span>
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--txt_path&#39;</span>, default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ImageSets/Main&#39;</span>, type<span style="color:#f92672">=</span>str, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;output txt label path&#39;</span>)
</span></span><span style="display:flex;"><span>opt <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>trainval_percent <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>  <span style="color:#75715e"># 训练集和验证集所占比例。 这里没有划分测试集</span>
</span></span><span style="display:flex;"><span>train_percent <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.9</span>     <span style="color:#75715e"># 训练集所占比例，可自己进行调整</span>
</span></span><span style="display:flex;"><span>xmlfilepath <span style="color:#f92672">=</span> opt<span style="color:#f92672">.</span>xml_path
</span></span><span style="display:flex;"><span>txtsavepath <span style="color:#f92672">=</span> opt<span style="color:#f92672">.</span>txt_path
</span></span><span style="display:flex;"><span>total_xml <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>listdir(xmlfilepath)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(txtsavepath):
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>makedirs(txtsavepath)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>num <span style="color:#f92672">=</span> len(total_xml)
</span></span><span style="display:flex;"><span>list_index <span style="color:#f92672">=</span> range(num)
</span></span><span style="display:flex;"><span>tv <span style="color:#f92672">=</span> int(num <span style="color:#f92672">*</span> trainval_percent)
</span></span><span style="display:flex;"><span>tr <span style="color:#f92672">=</span> int(tv <span style="color:#f92672">*</span> train_percent)
</span></span><span style="display:flex;"><span>trainval <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>sample(list_index, tv)
</span></span><span style="display:flex;"><span>train <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>sample(trainval, tr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file_trainval <span style="color:#f92672">=</span> open(txtsavepath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/trainval.txt&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>file_test <span style="color:#f92672">=</span> open(txtsavepath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/test.txt&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>file_train <span style="color:#f92672">=</span> open(txtsavepath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/train.txt&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>file_val <span style="color:#f92672">=</span> open(txtsavepath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/val.txt&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> list_index:
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> total_xml[i][:<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> i <span style="color:#f92672">in</span> trainval:
</span></span><span style="display:flex;"><span>        file_trainval<span style="color:#f92672">.</span>write(name)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">in</span> train:
</span></span><span style="display:flex;"><span>            file_train<span style="color:#f92672">.</span>write(name)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            file_val<span style="color:#f92672">.</span>write(name)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        file_test<span style="color:#f92672">.</span>write(name)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file_trainval<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>file_train<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>file_val<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>file_test<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p>然后在data/VOCData/ImageSets/Main目录下可以看到三个文件，就是划分的数据集合</p>
<p><img src="https://0ha.top/img/7d9f307921f7459192924249ad400e8c.png" alt=""></p>
<p><img src="https://0ha.top/img/4dff454320264605acf6cc06fcaeb8d8.png" alt=""></p>
<h2 id="把相应的文件路径存入txt文件中xml转为txt">把相应的文件路径存入txt文件中，xml转为txt</h2>
<p>因为是用刚刚的应用程序来标注的图片文件所以就不需要把xml转为yolo格式的文件了</p>
<p>在VOCData目录下创建一个py文件（名称随意）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> os <span style="color:#f92672">import</span> getcwd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>abs_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getcwd()
</span></span><span style="display:flex;"><span>print(abs_path)
</span></span><span style="display:flex;"><span>wd <span style="color:#f92672">=</span> getcwd()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> image_set <span style="color:#f92672">in</span> sets:
</span></span><span style="display:flex;"><span>    image_ids <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;D:/yolov5/data/VOCData/ImageSets/Main/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">.txt&#39;</span> <span style="color:#f92672">%</span> (image_set))<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(<span style="color:#e6db74">&#39;D:/yolov5/data/VOCData/dataSet_path/&#39;</span>):
</span></span><span style="display:flex;"><span>        os<span style="color:#f92672">.</span>makedirs(<span style="color:#e6db74">&#39;D:/yolov5/data/VOCData/dataSet_path/&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    list_file <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;dataSet_path/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">.txt&#39;</span> <span style="color:#f92672">%</span> (image_set), <span style="color:#e6db74">&#39;w&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 这行路径不需更改，这是相对路径</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> image_id <span style="color:#f92672">in</span> image_ids:
</span></span><span style="display:flex;"><span>        list_file<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;D:/yolov5/data/VOCData/images/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">.jpg</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> (image_id))
</span></span><span style="display:flex;"><span>        convert_annotation(image_id)
</span></span><span style="display:flex;"><span>    list_file<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p>这样就会在VOCData下出现这样一个文件夹</p>
<p><img src="https://0ha.top/img/8dd3565cc4994b9bb1eb25c86baeb754.png" alt=""></p>
<p>打开</p>
<p><img src="https://0ha.top/img/8e3f00d3b87c4c64b811f2aabfb3f8cc.png" alt=""></p>
<p>里面有各个文件的路径（因为没有划分test文件所以打开test.txt是空的）</p>
<p>最后需要把data/VOCData/Annotations的文件移到文件夹labels文件夹中（没有文件夹就自己创建）</p>
<h2 id="创建配置文件">创建配置文件</h2>
<p>在 yolov5 目录下的 data 文件夹下 <strong>新建一个 myvoc_1.yaml文件</strong>（可以自定义命名），用记事本打开。</p>
<p>内容是：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>train: D:<span style="color:#f92672">/</span>yolov5<span style="color:#f92672">/</span>data<span style="color:#f92672">/</span>VOCData<span style="color:#f92672">/</span>dataSet_path<span style="color:#f92672">/</span>train<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span>val: D:<span style="color:#f92672">/</span>yolov5<span style="color:#f92672">/</span>data<span style="color:#f92672">/</span>VOCData<span style="color:#f92672">/</span>dataSet_path<span style="color:#f92672">/</span>val<span style="color:#f92672">.</span>txt
</span></span><span style="display:flex;"><span><span style="color:#75715e">#文件的绝对路径（要改，注意是斜杠不是反斜杠）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#如果划分了test数据也需要加上去</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># number of classes</span>
</span></span><span style="display:flex;"><span>nc: <span style="color:#ae81ff">2</span>          <span style="color:#75715e">#类别个数（要改）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># class names</span>
</span></span><span style="display:flex;"><span>names: [<span style="color:#e6db74">&#34;light&#34;</span>, <span style="color:#e6db74">&#34;post&#34;</span>] <span style="color:#75715e">#类别（要改）</span>
</span></span></code></pre></div><h2 id="聚类获得先验框">聚类获得先验框</h2>
<p>因为什么提供的yolo版本很新所以一定在yolov5/utils下有 autoanchor.py文件（不用运行）</p>
<p>在model的文件夹中选择一个模型配置文件我选择的是yolov5s.yaml</p>
<p>官方的表格：</p>
<p><img src="https://0ha.top/img/47b5db61edec43b199e83385d3352d42.png" alt=""></p>
<p>打开yolov5s.yaml</p>
<p><img src="https://0ha.top/img/ecc96b0bc89146148a844088d58aa430.png" alt=""></p>
<p>把nc的值改成标注的种类个数就行了</p>
<h2 id="开始训练">开始训练</h2>
<p>打开根目录的train.py</p>
<p><img src="https://0ha.top/img/ca244b750ad3460c9e1870c8ecd854b8.png" alt=""></p>
<p>有很多的数据</p>
<p>weights：权重文件路径</p>
<p>cfg：存储模型结构的配置文件</p>
<p>data：存储训练、测试数据的文件</p>
<p>epochs：指的就是训练过程中整个数据集将被迭代（训练）了多少次，显卡不行你就调小点。</p>
<p>batch-size：训练完多少张图片才进行权重更新，显卡不行就调小点。</p>
<p>img-size：输入图片宽高，显卡不行就调小点。</p>
<p>device：cuda device, i.e. 0 or 0,1,2,3 or cpu。选择使用GPU还是CPU</p>
<p>workers：线程数。默认是8。</p>
<p>noautoanchor：不自动检验更新anchors
rect：进行矩形训练</p>
<p>resume：恢复最近保存的模型开始训练</p>
<p>nosave：仅保存最终checkpoint</p>
<p>notest：仅测试最后的epoch</p>
<p>evolve：进化超参数</p>
<p>bucket：gsutil bucket</p>
<p>cache-images：缓存图像以加快训练速度</p>
<p>name： 重命名results.txt to results_name.txt</p>
<p>adam：使用adam优化</p>
<p>multi-scale：多尺度训练，img-size +/- 50%</p>
<p>single-cls：单类别的训练集</p>
<h3 id="运行文件">运行文件：</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>python train<span style="color:#f92672">.</span>py <span style="color:#f92672">--</span>weights weights<span style="color:#f92672">/</span>yolov5s<span style="color:#f92672">.</span>pt  <span style="color:#f92672">--</span>cfg models<span style="color:#f92672">/</span>yolov5s<span style="color:#f92672">.</span>yaml  <span style="color:#f92672">--</span>data data<span style="color:#f92672">/</span>myvoc<span style="color:#f92672">.</span>yaml <span style="color:#f92672">--</span>epoch <span style="color:#ae81ff">200</span> <span style="color:#f92672">--</span>batch<span style="color:#f92672">-</span>size <span style="color:#ae81ff">8</span> <span style="color:#f92672">--</span>img <span style="color:#ae81ff">640</span>   <span style="color:#f92672">--</span>device cpu
</span></span></code></pre></div><h2 id="用gpu训练">用gpu训练</h2>
<h3 id="查看cuda版本">查看cuda版本</h3>
<p>首先看看自己的gpu型号（a卡跑不了ai）</p>
<p>输入</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>nvidia<span style="color:#f92672">-</span>smi
</span></span></code></pre></div><h2 id="https0hatopimg329530eb0b0949d2be70674e9f59d4d6png"><img src="https://0ha.top/img/329530eb0b0949d2be70674e9f59d4d6.png" alt=""></h2>
<p>选择高于他的版本的pytorch</p>
<h3 id="安装pytorch">安装pytorch</h3>
<p>打开pytorch官网</p>
<p><a href="https://pytorch.org/" title="PyTorch">PyTorch</a></p>
<p><img src="https://0ha.top/img/b13caa0a7fe54ff481c8888eaa42682e.png" alt=""></p>
<p>把这个117改成你要安装的版本11.6就改成116</p>
<h3 id="训练">训练</h3>
<p>最后开始训练</p>
<p>其实就是把&ndash;device的值改一下</p>
<p>打开任务管理器——性能</p>
<p><img src="https://0ha.top/img/2c762c24bad949ebb2b955f5034c852c.png" alt=""></p>
<p>0号gpu就写&ndash;device 0</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>python train<span style="color:#f92672">.</span>py <span style="color:#f92672">--</span>weights weights<span style="color:#f92672">/</span>yolov5s<span style="color:#f92672">.</span>pt  <span style="color:#f92672">--</span>cfg models<span style="color:#f92672">/</span>yolov5s<span style="color:#f92672">.</span>yaml  <span style="color:#f92672">--</span>data data<span style="color:#f92672">/</span>myvoc<span style="color:#f92672">.</span>yaml <span style="color:#f92672">--</span>epoch <span style="color:#ae81ff">200</span> <span style="color:#f92672">--</span>batch<span style="color:#f92672">-</span>size <span style="color:#ae81ff">8</span> <span style="color:#f92672">--</span>img <span style="color:#ae81ff">640</span>   <span style="color:#f92672">--</span>device cpu
</span></span></code></pre></div><h2 id="问题">问题</h2>
<h3 id="如果出现-页面太小无法完成操作的相关问题">如果出现 （页面太小，无法完成操作）的相关问题</h3>
<p>打开train.py</p>
<p>降低线程 &ndash;workes (默认是8) 。最后再试试调小 &ndash;batch-size，降低 &ndash;epoch</p>
<p>然后把刚刚运行的命令改一下参数我把worker改成1才可以跑</p>
<h2 id="参考文章">参考文章：</h2>
<p><a href="https://blog.csdn.net/qq_45945548/article/details/121701492" title="文章链接">文章链接</a></p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
